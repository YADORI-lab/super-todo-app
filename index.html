<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro - Ultimate Productivity Suite</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --success: #22c55e;
            --bg-light: #ffffff;
            --bg-dark: #0f172a;
            --surface-light: #f8fafc;
            --surface-dark: #1e293b;
            --text-light: #1e293b;
            --text-dark: #f1f5f9;
            --border-light: #e2e8f0;
            --border-dark: #334155;
            --shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
            --shadow-dark: 0 10px 25px -5px rgba(0,0,0,0.3), 0 8px 10px -6px rgba(0,0,0,0.2);
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
            color-scheme: light dark;
        }

        html[data-theme="light"] {
            --bg: var(--bg-light);
            --surface: var(--surface-light);
            --text: var(--text-light);
            --border: var(--border-light);
            --shadow: var(--shadow);
        }

        html[data-theme="dark"] {
            --bg: var(--bg-dark);
            --surface: var(--surface-dark);
            --text: var(--text-dark);
            --border: var(--border-dark);
            --shadow: var(--shadow-dark);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: all 0.3s ease;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .app-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            height: 100vh;
            transition: all 0.3s ease;
        }

        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            overflow-y: auto;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-section {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            opacity: 0.7;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0.8rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.2rem;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--primary);
            color: white;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--warning);
            color: white;
            padding: 0.2rem 0.4rem;
            border-radius: 0.4rem;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .main-content {
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--bg);
            position: relative;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .feature-counter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .feature-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            flex: 1;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: var(--text);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .header-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 0.75rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .view-toggle {
            display: flex;
            background: var(--surface);
            border-radius: 0.75rem;
            padding: 0.2rem;
            border: 1px solid var(--border);
        }

        .view-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            background: transparent;
            color: var(--text);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .theme-toggle {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.6rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .smart-input-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .input-row {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .quick-add-input {
            flex: 1;
            border: none;
            background: var(--bg);
            color: var(--text);
            font-size: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            outline: none;
            transition: all 0.2s ease;
        }

        .quick-add-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .ai-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .suggestion-chip {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-chip:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 1.5rem;
        }

        .content-area {
            min-height: 400px;
        }

        .sidebar-widgets {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .widget {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.2rem;
            box-shadow: var(--shadow);
        }

        .widget-title {
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .task-list {
            background: var(--surface);
            border-radius: 1rem;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item:hover {
            background: var(--bg);
            transform: translateX(4px);
        }

        .task-item.overdue {
            border-left: 4px solid var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        .task-item.due-today {
            border-left: 4px solid var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }

        .task-item.completed {
            opacity: 0.6;
            background: rgba(34, 197, 94, 0.05);
        }

        .task-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 0.4rem;
            margin-right: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-checkbox.checked {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
            font-size: 0.9rem;
        }

        .task-title.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .task-meta {
            display: flex;
            gap: 0.75rem;
            font-size: 0.75rem;
            opacity: 0.7;
            align-items: center;
        }

        .task-actions {
            display: flex;
            gap: 0.3rem;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .action-btn {
            padding: 0.3rem;
            border: none;
            background: var(--surface);
            color: var(--text);
            border-radius: 0.3rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem;
        }

        .action-btn:hover {
            background: var(--border);
        }

        /* Goal Tracking Styles */
        .goal-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .goal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .goal-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .goal-deadline {
            font-size: 0.8rem;
            color: var(--warning);
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .progress-section {
            margin: 1rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Analytics Styles */
        .analytics-grid {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .analytics-grid.active {
            display: grid;
        }

        .analytics-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.7;
            font-weight: 500;
            font-size: 0.9rem;
        }
        [data-requires-api] {
    transition: opacity 0.3s ease;
}

[data-requires-api]:hover:not([style*="pointer-events: auto"]) {
    cursor: not-allowed;
    position: relative;
}

[data-requires-api]:hover:not([style*="pointer-events: auto"])::after {
    content: "API key required - click to set up";
    position: absolute;
    top: 100%;
    left: 0;
    background: var(--surface);
    padding: 0.5rem;
    border-radius: 0.5rem;
    border: 1px solid var(--border);
    z-index: 100;
    width: max-content;
    max-width: 200px;
}

        .habit-tracker {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.3rem;
            margin-top: 0.75rem;
        }

        .habit-day {
            aspect-ratio: 1;
            border-radius: 0.3rem;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .habit-day.completed {
            background: var(--success);
            color: white;
        }

        .habit-day:hover {
            transform: scale(1.1);
        }

        /* Kanban Styles */
        .kanban-board {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .kanban-board.active {
            display: grid;
        }

        .kanban-column {
            background: var(--surface);
            border-radius: 1rem;
            border: 1px solid var(--border);
            padding: 1.2rem;
            min-height: 400px;
            box-shadow: var(--shadow);
        }

        .column-header {
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-count {
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
        }
        .back-btn {
    position: absolute;
    left: 1rem;
    top: 1rem;
    background: var(--primary);
    color: white;
    font-size: 1rem;
    padding: 0.3rem 1rem;
    border-radius: 2rem;
    border: none;
    z-index: 10;
    cursor: pointer;
}
.back-btn:hover { background: var(--primary-dark); }

        .kanban-task {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: move;
            transition: all 0.2s ease;
        }

        .kanban-task:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            position: relative;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        .focus-music-controls {
    margin-top: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
    align-items: center;
}
.focus-music-btn {
    background: var(--success);
    color: white;
    border: none;
    border-radius: 0.75rem;
    padding: 0.5rem 1.2rem;
    font-weight: 600;
    cursor: pointer;
    font-size: 0.95rem;
}
.focus-music-btn:hover { background: #16a34a; }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Floating Elements */
        .pomodoro-timer {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.2rem;
            min-width: 180px;
            text-align: center;
            z-index: 100;
        }

        .timer-display {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .timer-controls {
            display: flex;
            gap: 0.4rem;
            justify-content: center;
        }
        .ai-api-warning {
    color: var(--danger);
    font-size: 0.9rem;
    margin-bottom: 1rem;
    text-align: center;
}
.ai-api-link {
    display: inline-block;
    background: var(--info);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    margin-top: 0.5rem;
}
        .floating-fab {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            width: 56px;
            height: 56px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-fab:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.4);
        }

        /* Feature List Modal */
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .feature-category {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .feature-category h4 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        /* Note modal/button styles */
.modal-close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 0.75rem;
    font-size: 1.2rem;
    width: 32px;
    height: 32px;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}
.modal-close-btn:hover { background: #b91c1c; }
.notes-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}
.note-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 1rem;
    position: relative;
    min-height: 150px;
    cursor: pointer;
    transition: all 0.2s ease;
}
.note-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
}
.note-title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    padding-right: 1.5rem;
}
.note-content {
    font-size: 0.85rem;
    opacity: 0.8;
    white-space: pre-wrap;
}
.note-actions {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    display: flex;
    gap: 0.3rem;
}

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .feature-item i {
            color: var(--success);
            width: 16px;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem 1.2rem;
            box-shadow: var(--shadow);
            transform: translateX(400px);
            transition: all 0.3s ease;
            z-index: 1001;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .bounce {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .pomodoro-timer, .floating-fab {
                bottom: 1rem;
                right: 1rem;
            }
        }
        
        /* Mood tracker */
        .mood-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .mood-btn:hover {
            transform: scale(1.2);
        }
        
        /* Offline indicator */
        #offlineStatus {
            display: none; 
            padding: 0.5rem; 
            background: var(--warning); 
            color: white; 
            border-radius: 0.5rem;
            margin-right: 1rem;
        }
        
        /* Motivation bar */
        #motivationBar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem;
            background: var(--primary);
            color: white;
            text-align: center;
            font-weight: 500;
        }
        
        #motivationBar button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            margin-left: 1rem;
        }
    </style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZSPK7E0V45"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZSPK7E0V45');
</script>
</head>
<body>
    <!-- Motivation bar -->
    <div id="motivationBar" style="display: none;">
        <span id="motivationText"></span>
        <button onclick="closeMotivationBar()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- API Key Modal -->
    <div class="modal" id="apiKeyModal">
        <div class="modal-content">
            <h2>API Key Setup</h2>
            <p>To use AI features, you need an OpenRouter API key:</p>
            
            <div style="background: var(--surface); padding: 1rem; border-radius: 0.75rem; margin: 1rem 0;">
                <ol style="margin-bottom: 1rem;">
                    <li>Go to <a href="https://openrouter.ai/keys" target="_blank" style="color: var(--primary);">OpenRouter Keys</a></li>
                    <li>Create a free account</li>
                    <li>Copy your API key</li>
                </ol>
                <button class="btn btn-secondary" onclick="window.open('https://openrouter.ai/keys', '_blank')">
                    <i class="fas fa-external-link-alt"></i> Get API Key
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">Enter Your API Key:</label>
                <input type="password" class="form-input" id="apiKeyInput" placeholder="sk-or-v1-...">
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="closeApiKeyModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveApiKey()">Save Key</button>
            </div>
        </div>
    </div>
    
    <!-- Career Vision Modal -->
    <div class="modal" id="careerModal">
        <div class="modal-content">
            <button class="back-btn" onclick="closeCareerModal()"><i class="fas fa-arrow-left"></i> Back</button>
            <h2>Career Vision Wizard</h2>
            <div class="form-group">
                <label class="form-label">What career do you want to pursue?</label>
                <input type="text" class="form-input" id="careerGoal" placeholder="e.g., Data Scientist">
            </div>
            <div class="form-group">
                <label class="form-label">Years of Experience</label>
                <input type="number" class="form-input" id="experienceYears" min="0" max="50" value="0">
            </div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeCareerModal()">Cancel</button>
                <button class="btn btn-primary" onclick="generateCareerPlan()">Generate Plan</button>
            </div>
            <div id="careerReport" style="display: none; margin-top: 2rem;"></div>
        </div>
    </div>
    
    <!-- Learning Mentor Modal -->
    <div class="modal" id="aiTutorModal">
        <div class="modal-content">
            <h2>Learning Mentor</h2>
            <div id="aiChatContainer" style="height: 300px; overflow-y: auto; margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; background: var(--bg);"></div>
            <div class="input-row">
                <input type="text" class="quick-add-input" id="aiQuestion" placeholder="Ask anything...">
                <button class="btn btn-primary" onclick="askAI()">
                    <i class="fas fa-paper-plane"></i> Ask
                </button>
            </div>
            <div id="learningPlanContainer" style="display: none; margin-top: 1rem;">
                <h3>Your Learning Plan</h3>
                <div id="planContent"></div>
                <button class="btn btn-success" onclick="scheduleLearningPlan()" style="margin-top: 1rem;">
                    <i class="fas fa-calendar-plus"></i> Schedule Plan
                </button>
            </div>
        </div>
    </div>
    
    <!-- Deep Focus Modal -->
    <div class="modal" id="deepFocusModal">
        <div class="modal-content">
            <h2>Deep Focus Settings</h2>
            <div class="form-group">
                <label class="form-label">Sound Type</label>
                <select class="form-select" id="focusSound">
                    <option value="white">White Noise</option>
                    <option value="forest">Forest</option>
                    <option value="rain">Rain</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Duration (minutes)</label>
                <input type="number" class="form-input" id="focusDuration" min="5" max="120" value="25">
            </div>
            <div class="form-group">
                <label class="form-label">Volume</label>
                <input type="range" class="form-input" id="focusVolume" min="0" max="100" value="50">
            </div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeDeepFocusModal()">Cancel</button>
                <button class="btn btn-primary" onclick="startDeepFocus()">Start</button>
            </div>
        </div>
    </div>
    
    <!-- Note Modal -->
    <div class="modal" id="noteModal">
        <div class="modal-content" style="max-width: 500px; position:relative;">
            <button class="modal-close-btn" onclick="closeNoteModal()"><i class="fas fa-times"></i></button>
            <h2 id="noteModalTitle">Add Note</h2>
            <form id="noteForm">
                <div class="form-group">
                    <label class="form-label">Note Title *</label>
                    <input type="text" class="form-input" id="noteTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Content *</label>
                    <textarea class="form-textarea" id="noteContent" required></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeNoteModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Note</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Feature List Modal -->
    <div class="modal" id="featureModal">
        <div class="modal-content" style="max-width: 1000px;">
            <h2 style="margin-bottom: 1rem; text-align: center;">ðŸš€ TaskFlow Pro Features (50+)</h2>
            <p style="text-align: center; opacity: 0.8; margin-bottom: 2rem;">Comprehensive productivity suite designed to help you achieve your goals</p>
            
            <div class="feature-list">
                <div class="feature-category">
                    <h4><i class="fas fa-tasks"></i> Task Management</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Natural language input parsing</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Smart due date detection</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Priority-based organization</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Subtask hierarchies</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Tag-based categorization</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Drag & drop interface</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Time estimation & tracking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Recurring task templates</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-bullseye"></i> Goal Achievement</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> SMART goal framework</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Progress tracking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Milestone celebrations</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Goal decomposition</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Success criteria tracking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Automated reminders</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Visual progress indicators</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-brain"></i> AI-Powered Features</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Smart suggestions</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Productivity coaching tips</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Pattern recognition</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Workload optimization</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Auto-prioritization</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Deadline negotiations</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Voice command recognition</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-chart-line"></i> Analytics & Insights</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Productivity scoring</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Completion rate tracking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Time analysis</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Habit streak counters</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Peak performance hours</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Weekly/monthly reports</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Goal achievement rates</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-clock"></i> Time Management</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Pomodoro timer</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Time blocking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Focus mode</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Break reminders</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Session tracking</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Deep work indicators</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Distraction blocking</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-columns"></i> Multiple Views</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Dashboard overview</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Kanban boards</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Calendar integration</div>
                    <div class="feature-item"><i class="fas fa-check"></i> List views</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Analytics dashboards</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Habit trackers</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Goal progress views</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-palette"></i> Customization</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Dark/light themes</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Custom color schemes</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Layout preferences</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Widget configuration</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Notification settings</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Keyboard shortcuts</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Personal dashboard</div>
                </div>
                
                <div class="feature-category">
                    <h4><i class="fas fa-sync"></i> Data & Integration</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Auto-save functionality</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Cross-device sync ready</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Data export/import</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Backup & restore</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Calendar integration ready</div>
                    <div class="feature-item"><i class="fas fa-check"></i> API framework</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Offline functionality</div>
                </div>
            </div>
            
            <div style="margin-top: 2rem; text-align: center;">
                <button class="btn btn-primary" onclick="closeFeatureModal()">
                    <i class="fas fa-rocket"></i>
                    Start Using TaskFlow Pro
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <div class="app-container">
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                TaskFlow Pro
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">Main Views</div>
                <div class="nav-item active" data-view="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-view="tasks">
                    <i class="fas fa-tasks"></i>
                    <span>My Tasks</span>
                    <span class="badge" id="taskCount">0</span>
                </div>
                <div class="nav-item" data-view="goals">
                    <i class="fas fa-bullseye"></i>
                    <span>Goals</span>
                    <span class="badge" id="goalCount">0</span>
                </div>
                <div class="nav-item" data-view="kanban">
                    <i class="fas fa-columns"></i>
                    <span>Kanban Board</span>
                </div>
                <div class="nav-item" data-view="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </div>
                <div class="nav-item" data-view="habits">
                    <i class="fas fa-calendar-check"></i>
                    <span>Habits</span>
                </div>
                <div class="nav-item" data-view="notes">
                    <i class="fas fa-sticky-note"></i>
                    <span>Notes</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">Smart Lists</div>
                <div class="nav-item" data-filter="today">
                    <i class="fas fa-sun"></i>
                    <span>Today</span>
                    <span class="badge" id="todayCount">0</span>
                </div>
                <div class="nav-item" data-filter="overdue">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Overdue</span>
                    <span class="badge" id="overdueCount">0</span>
                </div>
                <div class="nav-item" data-filter="important">
                    <i class="fas fa-star"></i>
                    <span>Important</span>
                </div>
                <div class="nav-item" data-filter="completed">
                    <i class="fas fa-check-double"></i>
                    <span>Completed</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">Tags</div>
                <div class="nav-item" data-tag="work">
                    <i class="fas fa-briefcase"></i>
                    <span>Work</span>
                </div>
                <div class="nav-item" data-tag="personal">
                    <i class="fas fa-user"></i>
                    <span>Personal</span>
                </div>
                <div class="nav-item" data-tag="health">
                    <i class="fas fa-heartbeat"></i>
                    <span>Health</span>
                </div>
                <div class="nav-item" data-tag="learning">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Learning</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">AI Assistant</div>
                <div class="nav-item" onclick="showAICoach()">
                    <i class="fas fa-robot"></i>
                    <span>AI Coach</span>
                </div>
                <div class="nav-item" onclick="generateInsights()">
                    <i class="fas fa-lightbulb"></i>
                    <span>Insights</span>
                </div>
                <div class="nav-item" onclick="openCareerWizard()">
                    <i class="fas fa-briefcase"></i>
                    <span>Career Vision</span>
                </div>
                <div class="nav-item" onclick="openAITutor()">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Learning Mentor</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">Tools</div>
                <div class="nav-item" onclick="toggleDeepFocus()">
                    <i class="fas fa-headphones"></i>
                    <span>Deep Focus</span>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="top-bar">
                <div id="offlineStatus">
                    <i class="fas fa-plug"></i> Offline Mode
                </div>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <button class="btn btn-secondary" onclick="startVoiceCommand()">
                        <i class="fas fa-microphone-alt"></i> Voice
                    </button>
                    <button class="btn btn-secondary" id="deepFocusBtn" onclick="toggleDeepFocus()">
                        <i class="fas fa-headphones"></i> Deep Focus
                    </button>
                    <div class="feature-counter" onclick="showFeatureList()">
                        <i class="fas fa-magic"></i>
                        <span id="featureCount">50+</span>
                        <span>Features For Free</span>  
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div class="btn btn-secondary" onclick="exportData()">
                            <i class="fas fa-download"></i>
                            Export
                        </div>
                        <div class="btn btn-secondary" onclick="importData()">
                            <i class="fas fa-upload"></i>
                            Import
                        </div>
                        <div class="theme-toggle" onclick="toggleTheme()">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header">
                <div class="header-left">
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                    <p class="page-subtitle" id="pageSubtitle">Your productivity command center</p>
                </div>
                <div class="header-controls">
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                        </button>
                        <button class="view-btn" data-view="tasks">
                            <i class="fas fa-list"></i>
                        </button>
                        <button class="view-btn" data-view="kanban">
                            <i class="fas fa-columns"></i>
                        </button>
                        <button class="view-btn" data-view="analytics">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="view-btn" data-view="goals">
                            <i class="fas fa-bullseye"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary" onclick="openTaskModal()">
                        <i class="fas fa-plus"></i>
                        Add Task
                    </button>
                    <button class="btn btn-success" onclick="openGoalModal()">
                        <i class="fas fa-bullseye"></i>
                        Add Goal
                    </button>
                </div>
            </div>
            
            <div class="smart-input-section">
                <div class="input-row">
                    <input type="text" class="quick-add-input" id="quickAddInput" placeholder="ðŸŽ¯ Quick add: 'Finish report tomorrow 3pm' or 'Exercise daily'" onkeypress="handleQuickAdd(event)">
                    <button class="btn btn-primary" onclick="processQuickAdd()">
                        <i class="fas fa-magic"></i>
                        Add
                    </button>
                    <button class="btn btn-secondary" onclick="startVoiceInput()">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <div class="ai-suggestions" id="aiSuggestions">
                    <span style="font-size: 0.8rem; opacity: 0.7;">ðŸ’¡ AI Suggestions:</span>
                    <div class="suggestion-chip" onclick="applySuggestion('Plan weekly review')">Plan weekly review</div>
                    <div class="suggestion-chip" onclick="applySuggestion('Take 30min walk')">Daily walk</div>
                    <div class="suggestion-chip" onclick="applySuggestion('Read 20 pages')">Daily reading</div>
                    <div class="suggestion-chip" onclick="applySuggestion('Meditate 10min')">Meditation</div>
                </div>
            </div>
            
            <div class="main-grid">
                <div class="content-area">
                    <!-- Dashboard View -->
                    <div id="dashboardView" class="view-content">
                        <div class="analytics-grid active">
                            <div class="analytics-card">
                                <div class="stat-number" id="todayTasksCount">0</div>
                                <div class="stat-label">Today's Tasks</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="completionRate">0%</div>
                                <div class="stat-label">Completion Rate</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="completionProgress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="productivityScore">85</div>
                                <div class="stat-label">Productivity Score</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="streakDays">7</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="activeGoals">0</div>
                                <div class="stat-label">Active Goals</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="totalTime">2.5h</div>
                                <div class="stat-label">Time Today</div>
                            </div>
                        </div>
                        
                        <div class="goal-card">
                            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-bullseye"></i>
                                Current Goals Progress
                            </h3>
                            <div id="goalsList">
                                <!-- Goals will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tasks View -->
                    <div id="tasksView" class="view-content" style="display: none;">
                        <div id="taskFilters" style="margin-bottom: 1rem;">
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button class="btn btn-secondary active" data-filter="all">All</button>
                                <button class="btn btn-secondary" data-filter="today">Today</button>
                                <button class="btn btn-secondary" data-filter="overdue">Overdue</button>
                                <button class="btn btn-secondary" data-filter="high">High Priority</button>
                                <button class="btn btn-secondary" data-filter="study">Study</button>
                                <button class="btn btn-secondary" data-filter="work">Work</button>
                                <button class="btn btn-secondary" data-filter="personal">Personal</button>
                            </div>
                        </div>
                        <div id="listView" class="task-list">
                            <!-- Tasks will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Goals View -->
                    <div id="goalsView" class="view-content" style="display: none;">
                        <div id="goalsContainer">
                            <!-- Goals will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Kanban View -->
                    <div id="kanbanView" class="kanban-board" style="display: none;">
                        <div class="kanban-column">
                            <div class="column-header">
                                <span>ðŸ“‹ To Do</span>
                                <span class="task-count" id="todoCount">0</span>
                            </div>
                            <div class="kanban-tasks" data-status="todo"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <span>ðŸ”„ In Progress</span>
                                <span class="task-count" id="progressCount">0</span>
                            </div>
                            <div class="kanban-tasks" data-status="progress"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <span>ðŸ” Review</span>
                                <span class="task-count" id="reviewCount">0</span>
                            </div>
                            <div class="kanban-tasks" data-status="review"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <span>âœ… Completed</span>
                                <span class="task-count" id="completedCount">0</span>
                            </div>
                            <div class="kanban-tasks" data-status="completed"></div>
                        </div>
                    </div>
                    
                    <!-- Analytics View -->
                    <div id="analyticsView" class="view-content" style="display: none;">
                        <div class="analytics-grid active">
                            <div class="analytics-card">
                                <div class="stat-number" id="totalTasks">0</div>
                                <div class="stat-label">Total Tasks</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="completedTasks">0</div>
                                <div class="stat-label">Completed</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="analyticsProgress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="avgCompletionTime">2.3h</div>
                                <div class="stat-label">Avg. Completion Time</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="mostProductiveTime">2-4 PM</div>
                                <div class="stat-label">Most Productive</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="weeklyGoals">3/5</div>
                                <div class="stat-label">Weekly Goals</div>
                            </div>
                            <div class="analytics-card">
                                <div class="stat-number" id="focusTime">4.2h</div>
                                <div class="stat-label">Focus Time Today</div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <div class="widget-title">
                                <i class="fas fa-chart-line"></i>
                                Productivity Trends
                            </div>
                            <div style="height: 200px; background: var(--bg); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; opacity: 0.5;">
                                ðŸ“ˆ Productivity chart visualization would go here
                            </div>
                        </div>
                    </div>
                    
                    <!-- Habits View -->
                    <div id="habitsView" class="view-content" style="display: none;">
                        <div class="widget">
                            <div class="widget-title">
                                <i class="fas fa-calendar-check"></i>
                                Daily Habits
                            </div>
                            <div id="habitsList">
                                <!-- Habits will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notes View -->
                    <div id="notesView" class="view-content" style="display: none;">
                        <div class="header-controls" style="margin-bottom: 1.5rem;">
                            <button class="btn btn-primary" onclick="openNoteModal()">
                                <i class="fas fa-plus"></i> Add Note
                            </button>
                        </div>
                        <div class="notes-container" id="notesContainer">
                            <!-- Notes will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-widgets">
                    <!-- Mood Tracker Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-smile"></i>
                            Daily Mood
                        </div>
                        <div style="display: flex; justify-content: space-around; margin-top: 1rem;">
                            <button class="mood-btn" data-mood="1">ðŸ˜¢</button>
                            <button class="mood-btn" data-mood="2">ðŸ˜•</button>
                            <button class="mood-btn" data-mood="3">ðŸ˜</button>
                            <button class="mood-btn" data-mood="4">ðŸ˜Š</button>
                            <button class="mood-btn" data-mood="5">ðŸ˜„</button>
                        </div>
                    </div>
                    
                    <!-- Quick Stats Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-bolt"></i>
                            Quick Stats
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.75rem; font-size: 0.85rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Tasks Today:</span>
                                <strong id="todayStats">0/0</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>This Week:</span>
                                <strong id="weekStats">0/0</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Goals Progress:</span>
                                <strong id="goalProgress">0%</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Focus Time:</span>
                                <strong id="focusTimeToday">0m</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Coach Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-robot"></i>
                            AI Coach
                        </div>
                        <div id="aiCoachTips" style="font-size: 0.85rem; line-height: 1.4;">
                            <p style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Today's Tip:</strong></p>
                            <p style="opacity: 0.8;">Break large tasks into smaller, actionable steps to maintain momentum and feel accomplished.</p>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 0.75rem;" onclick="getNewTip()">
                            <i class="fas fa-refresh"></i>
                            New Tip
                        </button>
                    </div>
                    
                    <!-- Calendar Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-calendar"></i>
                            Mini Calendar
                        </div>
                        <div id="miniCalendar" style="font-size: 0.8rem;">
                            <!-- Mini calendar will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Recent Activity Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-clock"></i>
                            Recent Activity
                        </div>
                        <div id="recentActivity" style="font-size: 0.8rem;">
                            <!-- Recent activities will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Habit Tracker Widget -->
                    <div class="widget">
                        <div class="widget-title">
                            <i class="fas fa-fire"></i>
                            Streak Tracker
                        </div>
                        <div style="text-align: center; margin-bottom: 0.75rem;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">ðŸ”¥</div>
                            <div style="font-size: 1.2rem; font-weight: 600;" id="currentStreak">7 Days</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">Current Streak</div>
                        </div>
                        <div class="habit-tracker" id="streakTracker">
                            <!-- Habit tracking grid will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pomodoro Timer -->
    <div class="pomodoro-timer">
        <div style="font-size: 0.8rem; margin-bottom: 0.5rem; opacity: 0.7;">Focus Timer</div>
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="timer-controls">
            <button class="btn btn-secondary" onclick="startTimer()" style="padding: 0.4rem 0.6rem;">
                <i class="fas fa-play" id="playIcon"></i>
            </button>
            <button class="btn btn-secondary" onclick="resetTimer()" style="padding: 0.4rem 0.6rem;">
                <i class="fas fa-stop"></i>
            </button>
        </div>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.6;">
            Session <span id="sessionCount">1</span>/4
        </div>
    </div>
    
    <!-- Floating Action Button -->
    <button class="floating-fab" onclick="quickActions()">
        <i class="fas fa-magic"></i>
    </button>
    
    <!-- Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h2>Add New Task</h2>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Task Title *</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="form-input" id="taskTitle" required>
                        <button type="button" class="btn btn-secondary" onclick="searchDeepSeek()" style="padding: 10px 15px">
                            <i class="fas fa-search"></i> DeepSeek
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Category *</label>
                    <select class="form-select" id="taskCategory" required>
                        <option value="work">Work</option>
                        <option value="study">Study</option>
                        <option value="personal">Personal</option>
                        <option value="health">Health</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="taskDescription" placeholder="Add detailed description..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select class="form-select" id="taskPriority">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="taskStatus">
                            <option value="todo">To Do</option>
                            <option value="progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Due Date</label>
                        <input type="datetime-local" class="form-input" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estimated Time (hours)</label>
                        <input type="number" class="form-input" id="taskEstimatedTime" min="0.25" step="0.25">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tags (comma-separated)</label>
                    <input type="text" class="form-input" id="taskTags" placeholder="work, personal, urgent">
                </div>
                <div class="form-group">
                    <label class="form-label">Subtasks (one per line)</label>
                    <textarea class="form-textarea" id="taskSubtasks" placeholder="Research requirements&#10;Create outline&#10;Write first draft"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Task</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Goal Modal -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <h2>Add New Goal</h2>
            <form id="goalForm">
                <div class="form-group">
                    <label class="form-label">Goal Title *</label>
                    <input type="text" class="form-input" id="goalTitle" required placeholder="e.g., Learn Spanish, Run 5K, Complete Project">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="goalDescription" placeholder="Describe your goal in detail..."></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="goalCategory">
                            <option value="personal">Personal</option>
                            <option value="work">Work</option>
                            <option value="health">Health</option>
                            <option value="learning">Learning</option>
                            <option value="financial">Financial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Target Date</label>
                        <input type="date" class="form-input" id="goalTargetDate">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Success Criteria (one per line)</label>
                    <textarea class="form-textarea" id="goalCriteria" placeholder="Complete all 20 lessons&#10;Practice speaking 30 minutes daily&#10;Pass final assessment"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeGoalModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Goal</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Application State
        let tasks = [];
        let goals = [];
        let habits = [];
        let notes = [];
        let currentView = 'dashboard';
        let currentFilter = 'all';
        let timerInterval = null;
        let timerMinutes = 25;
        let timerSeconds = 0;
        let isTimerRunning = false;
        let sessionCount = 1;
        let userApiKey = localStorage.getItem('userApiKey') || '';
        let deepFocusActive = false;
        let aiRequestQueue = [];
        let lastAICallTime = 0;
        const AI_COOLDOWN = 5000; // 5 seconds between requests
        
        // AI Coach Tips
        const aiTips = [
            "Break large tasks into smaller, actionable steps to maintain momentum and feel accomplished.",
            "Use the Pomodoro Technique: 25 minutes of focused work, 5-minute break.",
            "Schedule your most important tasks during your peak energy hours.",
            "Review and adjust your goals weekly to stay on track.",
            "Celebrate small wins to maintain motivation throughout your journey.",
            "Use time-blocking to dedicate specific periods to different types of work.",
            "Eliminate distractions by creating a dedicated workspace.",
            "Practice the 2-minute rule: if it takes less than 2 minutes, do it now.",
            "Set realistic deadlines and build in buffer time for unexpected delays.",
            "Use the Eisenhower Matrix to prioritize tasks by urgency and importance."
        ];
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            // Load data safely
            tasks = loadFromLocalStorage('taskflow-tasks');
            goals = loadFromLocalStorage('taskflow-goals');
            habits = loadFromLocalStorage('taskflow-habits');
            notes = loadFromLocalStorage('taskflow-notes');
            
            // Initialize theme
            const savedTheme = localStorage.getItem('taskflow-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Set theme icon
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
            
            // Load sample data if needed
            loadSampleData();
            
            // Initial render
            renderAll();
            updateAnalytics();
            setupEventListeners();
            generateMiniCalendar();
            updateStreakTracker();
            updateApiKeyStatus();
            checkOnlineStatus();
            
            // Auto-save every 30 seconds
            setInterval(saveAllData, 30000);
            
            // Update time-based data every minute
            setInterval(updateTimeBasedData, 60000);
            
            // Welcome message for new users
            setTimeout(() => {
                if (!localStorage.getItem('taskflow-welcomed')) {
                    showNotification('Welcome to TaskFlow Pro! ðŸš€ Start by adding your first task or goal.', 'success');
                    localStorage.setItem('taskflow-welcomed', 'true');
                }
            }, 1000);
            
            // Auto-update AI suggestions every 5 minutes
            setInterval(updateAISuggestions, 5 * 60 * 1000);
            
            // Start notifications check
            checkForNotifications();
            
            console.log('ðŸš€ TaskFlow Pro initialized!');
        });
        
        // Safe localStorage loading
        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error(`Error loading ${key}:`, e);
                return [];
            }
        }
        
        // Event Listeners Setup
        function setupEventListeners() {
            // View switching
            document.querySelectorAll('[data-view]').forEach(el => {
                el.addEventListener('click', (e) => {
                    const view = e.target.closest('[data-view]').dataset.view;
                    switchView(view);
                });
            });
            
            // Filter switching
            document.querySelectorAll('[data-filter]').forEach(el => {
                el.addEventListener('click', (e) => {
                    const filter = e.target.closest('[data-filter]').dataset.filter;
                    setFilter(filter);
                });
            });
            
            // Form submissions
            document.getElementById('taskForm').addEventListener('submit', handleTaskSubmit);
            document.getElementById('goalForm').addEventListener('submit', handleGoalSubmit);
            document.getElementById('noteForm').addEventListener('submit', handleNoteSubmit);
            
            // Mood tracking
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const mood = e.target.closest('.mood-btn').dataset.mood;
                    localStorage.setItem('dailyMood', mood);
                    showNotification('Mood recorded!', 'success');
                });
            });
            
            // Voice recognition setup
            if ('webkitSpeechRecognition' in window) {
                window.recognition = new webkitSpeechRecognition();
                window.recognition.continuous = false;
                window.recognition.interimResults = false;
                window.recognition.lang = 'en-US';
                
                window.recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    const quickAddInput = document.getElementById('quickAddInput');
                    if (quickAddInput) {
                        quickAddInput.value = transcript;
                        processQuickAdd();
                        showNotification('Voice input processed: "' + transcript + '"', 'success');
                    }
                };
                
                window.recognition.onerror = function() {
                    showNotification('Voice recognition error. Please try again.', 'error');
                };
            }
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey)) {
                    switch(e.key) {
                        case 'k':
                            e.preventDefault();
                            const quickAddInput = document.getElementById('quickAddInput');
                            if (quickAddInput) quickAddInput.focus();
                            break;
                        case 'n':
                            e.preventDefault();
                            openTaskModal();
                            break;
                        case 'g':
                            e.preventDefault();
                            openGoalModal();
                            break;
                    }
                }
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            // Online/offline events
            window.addEventListener('online', function() {
                checkOnlineStatus();
                processAIQueue();
            });
            window.addEventListener('offline', checkOnlineStatus);
        }
        
        // Task Management Functions
        function addTask(taskData) {
            const task = {
                id: Date.now() + Math.random(),
                title: taskData.title,
                category: taskData.category || 'other',
                description: taskData.description || '',
                priority: taskData.priority || 'medium',
                status: taskData.status || 'todo',
                completed: taskData.status === 'completed',
                dueDate: taskData.dueDate || null,
                tags: taskData.tags || [],
                subtasks: taskData.subtasks || [],
                createdAt: new Date().toISOString(),
                completedAt: null,
                timeSpent: 0,
                estimatedTime: taskData.estimatedTime || null,
                goalId: taskData.goalId || null
            };
            
            // Process subtasks
            if (taskData.subtasksText) {
                task.subtasks = taskData.subtasksText.split('\n')
                    .filter(s => s.trim())
                    .map(s => ({
                        id: Date.now() + Math.random(),
                        text: s.trim(),
                        completed: false
                    }));
            }
            
            tasks.unshift(task);
            saveAllData();
            renderAll();
            updateAnalytics();
            showNotification('Task added successfully! ðŸŽ‰', 'success');
            
            return task;
        }
        
        function toggleTask(taskId) {
            const task = tasks.find(t => t.id == taskId);
            if (task) {
                task.completed = !task.completed;
                task.status = task.completed ? 'completed' : 'todo';
                task.completedAt = task.completed ? new Date().toISOString() : null;
                
                // Update related goal progress
                if (task.goalId) {
                    updateGoalProgress(task.goalId);
                }
                
                saveAllData();
                renderAll();
                updateAnalytics();
                
                const message = task.completed ? 'Task completed! Great job! ðŸŽ‰' : 'Task marked as incomplete';
                showNotification(message, task.completed ? 'success' : 'info');
                
                if (task.completed) {
                    triggerCelebration();
                }
            }
        }
        
        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id != taskId);
            saveAllData();
            renderAll();
            updateAnalytics();
            showNotification('Task deleted', 'error');
        }
        
        function editTask(taskId) {
            const task = tasks.find(t => t.id == taskId);
            if (task) {
                const taskTitle = document.getElementById('taskTitle');
                const taskDescription = document.getElementById('taskDescription');
                const taskCategory = document.getElementById('taskCategory');
                const taskPriority = document.getElementById('taskPriority');
                const taskStatus = document.getElementById('taskStatus');
                const taskDueDate = document.getElementById('taskDueDate');
                const taskEstimatedTime = document.getElementById('taskEstimatedTime');
                const taskTags = document.getElementById('taskTags');
                const taskSubtasks = document.getElementById('taskSubtasks');
                
                if (taskTitle) taskTitle.value = task.title;
                if (taskDescription) taskDescription.value = task.description;
                if (taskCategory) taskCategory.value = task.category;
                if (taskPriority) taskPriority.value = task.priority;
                if (taskStatus) taskStatus.value = task.status;
                if (taskDueDate) taskDueDate.value = task.dueDate ? 
                    new Date(task.dueDate).toISOString().slice(0, 16) : '';
                if (taskEstimatedTime) taskEstimatedTime.value = task.estimatedTime || '';
                if (taskTags) taskTags.value = task.tags.join(', ');
                if (taskSubtasks) taskSubtasks.value = task.subtasks.map(s => s.text).join('\n');
                
                const taskForm = document.getElementById('taskForm');
                if (taskForm) {
                    taskForm.dataset.editId = taskId;
                }
                
                const modalTitle = document.querySelector('#taskModal h2');
                if (modalTitle) modalTitle.textContent = 'Edit Task';
                
                const submitButton = document.querySelector('#taskForm button[type="submit"]');
                if (submitButton) submitButton.textContent = 'Update Task';
                
                openTaskModal();
            }
        }
        
        // Goal Management Functions
        function addGoal(goalData) {
            const goal = {
                id: Date.now() + Math.random(),
                title: goalData.title,
                description: goalData.description || '',
                category: goalData.category || 'personal',
                targetDate: goalData.targetDate || null,
                criteria: goalData.criteria || [],
                progress: 0,
                createdAt: new Date().toISOString(),
                completedAt: null,
                relatedTasks: []
            };
            
            // Process criteria
            if (goalData.criteriaText) {
                goal.criteria = goalData.criteriaText.split('\n')
                    .filter(c => c.trim())
                    .map(c => ({
                        id: Date.now() + Math.random(),
                        text: c.trim(),
                        completed: false
                    }));
            }
            
            goals.unshift(goal);
            saveAllData();
            renderAll();
            updateAnalytics();
            showNotification('Goal added successfully! ðŸŽ¯', 'success');
            
            return goal;
        }
        
        function updateGoalProgress(goalId) {
            const goal = goals.find(g => g.id == goalId);
            if (goal) {
                const relatedTasks = tasks.filter(t => t.goalId == goalId);
                const completedTasks = relatedTasks.filter(t => t.completed);
                goal.progress = relatedTasks.length > 0 ? 
                    Math.round((completedTasks.length / relatedTasks.length) * 100) : 0;
                
                saveAllData();
                renderAll();
            }
        }
        
        // Natural Language Processing
        function parseNaturalLanguage(text) {
            const task = {
                title: text,
                priority: 'medium',
                tags: [],
                dueDate: null,
                status: 'todo',
                category: 'other'
            };
            
            // Extract priority
            if (text.match(/urgent|important|critical/i)) {
                task.priority = 'high';
                task.title = task.title.replace(/urgent|important|critical/gi, '').trim();
            } else if (text.match(/someday|maybe|later/i)) {
                task.priority = 'low';
                task.title = task.title.replace(/someday|maybe|later/gi, '').trim();
            }
            
            // Extract tags
            const tagMatches = text.match(/#\w+/g);
            if (tagMatches) {
                task.tags = tagMatches.map(tag => tag.substring(1));
                task.title = task.title.replace(/#\w+/g, '').trim();
            }
            
            // Extract status
            if (text.match(/in progress|working on|started/i)) {
                task.status = 'progress';
                task.title = task.title.replace(/in progress|working on|started/gi, '').trim();
            } else if (text.match(/review|check|verify/i)) {
                task.status = 'review';
                task.title = task.title.replace(/review|check|verify/gi, '').trim();
            }
            
            // Extract due date
            const now = new Date();
            let dueDate = null;
            
            if (text.match(/tomorrow/i)) {
                dueDate = new Date(now);
                dueDate.setDate(dueDate.getDate() + 1);
                task.title = task.title.replace(/tomorrow/gi, '').trim();
            } else if (text.match(/today/i)) {
                dueDate = new Date(now);
                task.title = task.title.replace(/today/gi, '').trim();
            } else if (text.match(/next week/i)) {
                dueDate = new Date(now);
                dueDate.setDate(dueDate.getDate() + 7);
                task.title = task.title.replace(/next week/gi, '').trim();
            } else if (text.match(/monday|tuesday|wednesday|thursday|friday|saturday|sunday/i)) {
                const dayMatch = text.match(/(monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i);
                if (dayMatch) {
                    const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                    const targetDay = days.indexOf(dayMatch[1].toLowerCase());
                    const currentDay = now.getDay();
                    let daysToAdd = (targetDay - currentDay + 7) % 7;
                    if (daysToAdd === 0) daysToAdd = 7; // Next week if same day
                    
                    dueDate = new Date(now);
                    dueDate.setDate(dueDate.getDate() + daysToAdd);
                    task.title = task.title.replace(new RegExp(dayMatch[1], 'gi'), '').trim();
                }
            }
            
            // Extract time
            const timeMatch = text.match(/(\d{1,2}):?(\d{2})?\s*(am|pm)/i);
            if (timeMatch && dueDate) {
                let hours = parseInt(timeMatch[1]);
                const minutes = parseInt(timeMatch[2]) || 0;
                const period = timeMatch[3].toLowerCase();
                
                if (period === 'pm' && hours !== 12) hours += 12;
                if (period === 'am' && hours === 12) hours = 0;
                
                dueDate.setHours(hours, minutes, 0, 0);
                task.title = task.title.replace(/\d{1,2}:?\d{2}?\s*(am|pm)/gi, '').trim();
            } else if (timeMatch && !dueDate) {
                // If time is specified but no date, assume today
                dueDate = new Date(now);
                let hours = parseInt(timeMatch[1]);
                const minutes = parseInt(timeMatch[2]) || 0;
                const period = timeMatch[3].toLowerCase();
                
                if (period === 'pm' && hours !== 12) hours += 12;
                if (period === 'am' && hours === 12) hours = 0;
                
                dueDate.setHours(hours, minutes, 0, 0);
                task.title = task.title.replace(/\d{1,2}:?\d{2}?\s*(am|pm)/gi, '').trim();
            }
            
            if (dueDate) {
                task.dueDate = dueDate.toISOString();
            }
            
            // Clean up extra spaces
            task.title = task.title.replace(/\s+/g, ' ').trim();
            
            return task;
        }
        
        function handleQuickAdd(event) {
            if (event.key === 'Enter') {
                processQuickAdd();
            }
        }
        
        function processQuickAdd() {
            const input = document.getElementById('quickAddInput');
            if (!input) return;
            
            const text = input.value.trim();
            
            if (text) {
                const parsedTask = parseNaturalLanguage(text);
                addTask(parsedTask);
                input.value = '';
                updateAISuggestions();
            }
        }
        
        // Rendering Functions
        function renderAll() {
            renderTasks();
            renderGoals();
            renderNotes();
            renderDashboard();
            updateCounts();
        }
        
        function renderTasks() {
            const listView = document.getElementById('listView');
            const kanbanColumns = document.querySelectorAll('.kanban-tasks');
            
            // Clear existing content only if elements exist
            if (listView) listView.innerHTML = '';
            if (kanbanColumns) kanbanColumns.forEach(col => col.innerHTML = '');
            
            let filteredTasks = filterTasks();
            
            if (filteredTasks.length === 0 && listView) {
                listView.innerHTML = `
                    <div style="text-align: center; padding: 4rem; opacity: 0.5;">
                        <i class="fas fa-tasks" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                        <p>No tasks found. Create your first task to get started!</p>
                    </div>
                `;
                return;
            }
            
            filteredTasks.forEach(task => {
                // List view
                const taskEl = createTaskElement(task);
                if (listView) listView.appendChild(taskEl);
                
                // Kanban view
                const kanbanTask = createKanbanTaskElement(task);
                const column = document.querySelector(`[data-status="${task.status}"]`);
                if (column) column.appendChild(kanbanTask);
            });
            
            updateKanbanCounts();
        }
        
        function filterTasks() {
            let filtered = tasks;
            
            switch(currentFilter) {
                case 'today':
                    const today = new Date().toDateString();
                    filtered = tasks.filter(t => {
                        if (!t.dueDate) return false;
                        return new Date(t.dueDate).toDateString() === today;
                    });
                    break;
                case 'overdue':
                    const now = new Date();
                    filtered = tasks.filter(t => {
                        if (!t.dueDate || t.completed) return false;
                        return new Date(t.dueDate) < now;
                    });
                    break;
                case 'high':
                    filtered = tasks.filter(t => t.priority === 'high');
                    break;
                case 'study':
                case 'work':
                case 'personal':
                case 'health':
                    filtered = tasks.filter(t => t.category === currentFilter);
                    break;
                case 'completed':
                    filtered = tasks.filter(t => t.completed);
                    break;
                default:
                    filtered = tasks;
            }
            
            return filtered.sort((a, b) => {
                // Sort by priority, then by due date, then by creation date
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                if (a.priority !== b.priority) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                if (a.dueDate && b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                if (a.dueDate) return -1;
                if (b.dueDate) return 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
        }
        
        function createTaskElement(task) {
            const div = document.createElement('div');
            const isOverdue = task.dueDate && new Date(task.dueDate) < new Date() && !task.completed;
            const isDueToday = task.dueDate && new Date(task.dueDate).toDateString() === new Date().toDateString();
            
            let className = 'task-item fade-in';
            if (isOverdue) className += ' overdue';
            else if (isDueToday) className += ' due-today';
            if (task.completed) className += ' completed';
            
            div.className = className;
            div.innerHTML = `
                <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})">
                    ${task.completed ? '<i class="fas fa-check" style="color: white; font-size: 0.7rem;"></i>' : ''}
                </div>
                <div class="task-content">
                    <div class="task-title ${task.completed ? 'completed' : ''}">${task.title}</div>
                    <div class="task-meta">
                        <span><i class="fas fa-tag"></i> ${task.category}</span>
                        ${task.dueDate ? `<span><i class="fas fa-clock"></i> ${formatDate(task.dueDate)}</span>` : ''}
                        <span><i class="fas fa-flag"></i> ${task.priority}</span>
                        ${task.estimatedTime ? `<span><i class="fas fa-stopwatch"></i> ${task.estimatedTime}h</span>` : ''}
                        ${task.subtasks.length ? `<span><i class="fas fa-list"></i> ${task.subtasks.filter(s => s.completed).length}/${task.subtasks.length}</span>` : ''}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="action-btn" onclick="editTask(${task.id})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn" onclick="startTaskTimer(${task.id})" title="Start Timer">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="action-btn" onclick="deleteTask(${task.id})" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            return div;
        }
        
        function createKanbanTaskElement(task) {
            const div = document.createElement('div');
            div.className = 'kanban-task';
            div.draggable = true;
            div.dataset.taskId = task.id;
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                    <div style="font-weight: 600; font-size: 0.9rem;">${task.title}</div>
                    <div style="display: flex; gap: 0.3rem;">
                        <button class="action-btn" onclick="editTask(${task.id})" title="Edit" style="padding: 0.2rem;">
                            <i class="fas fa-edit" style="font-size: 0.7rem;"></i>
                        </button>
                    </div>
                </div>
                ${task.description ? `<div style="font-size: 0.8rem; opacity: 0.7; margin-bottom: 0.5rem;">${task.description.substring(0, 100)}${task.description.length > 100 ? '...' : ''}</div>` : ''}
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.7rem; margin-top: 0.5rem;">
                    <span style="padding: 0.2rem 0.4rem; border-radius: 0.25rem; background: var(--${task.category === 'study' ? 'info' : task.category === 'work' ? 'primary' : task.category === 'personal' ? 'success' : 'warning'}); color: white; font-weight: 600;">
                        ${task.category.toUpperCase()}
                    </span>
                    <span class="priority-badge" style="padding: 0.2rem 0.4rem; border-radius: 0.25rem; background: var(--${task.priority === 'high' ? 'danger' : task.priority === 'medium' ? 'warning' : 'success'}); color: white; font-weight: 600;">
                        ${task.priority.toUpperCase()}
                    </span>
                </div>
                ${task.subtasks.length ? `
                    <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.7;">
                        <i class="fas fa-list"></i> ${task.subtasks.filter(s => s.completed).length}/${task.subtasks.length} subtasks
                    </div>
                ` : ''}
            `;
            
            // Add drag and drop functionality
            div.addEventListener('dragstart', handleDragStart);
            
            return div;
        }
        
        function renderGoals() {
            const goalsContainer = document.getElementById('goalsContainer');
            const goalsList = document.getElementById('goalsList');
            
            if (goals.length === 0) {
                const emptyState = `
                    <div style="text-align: center; padding: 4rem; opacity: 0.5;">
                        <i class="fas fa-bullseye" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                        <p>No goals set yet. Create your first goal to start achieving!</p>
                        <button class="btn btn-primary" onclick="openGoalModal()" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Add Your First Goal
                        </button>
                    </div>
                `;
                if (goalsContainer) goalsContainer.innerHTML = emptyState;
                if (goalsList) goalsList.innerHTML = emptyState;
                return;
            }
            
            const goalsHtml = goals.map(goal => createGoalElement(goal)).join('');
            if (goalsContainer) goalsContainer.innerHTML = goalsHtml;
            
            // Show only top 3 goals in dashboard
            const dashboardGoals = goals.slice(0, 3).map(goal => createGoalElement(goal, true)).join('');
            if (goalsList) goalsList.innerHTML = dashboardGoals;
        }
        
        function createGoalElement(goal, compact = false) {
            const daysLeft = goal.targetDate ? 
                Math.ceil((new Date(goal.targetDate) - new Date()) / (1000 * 60 * 60 * 24)) : null;
            const completedCriteria = goal.criteria.filter(c => c.completed).length;
            const progress = goal.criteria.length > 0 ? 
                Math.round((completedCriteria / goal.criteria.length) * 100) : 0;
            
            return `
                <div class="goal-card ${compact ? 'compact' : ''}">
                    <div class="goal-header">
                        <div>
                            <div class="goal-title">${goal.title}</div>
                            ${goal.targetDate ? `
                                <div class="goal-deadline">
                                    <i class="fas fa-calendar"></i>
                                    ${daysLeft > 0 ? `${daysLeft} days left` : daysLeft === 0 ? 'Due today!' : `${Math.abs(daysLeft)} days overdue`}
                                </div>
                            ` : ''}
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="action-btn" onclick="editGoal(${goal.id})" title="Edit Goal">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${!compact ? `
                                <button class="action-btn" onclick="deleteGoal(${goal.id})" title="Delete Goal">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${!compact && goal.description ? `
                        <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem;">
                            ${goal.description}
                        </div>
                    ` : ''}
                    
                    <div class="progress-section">
                        <div class="progress-text">
                            <span>Progress</span>
                            <span>${progress}% (${completedCriteria}/${goal.criteria.length})</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    
                    ${!compact && goal.criteria.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <div style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">Success Criteria:</div>
                            ${goal.criteria.map(criterion => `
                                <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; margin-bottom: 0.3rem;">
                                    <div class="task-checkbox ${criterion.completed ? 'checked' : ''}" 
                                         onclick="toggleGoalCriterion(${goal.id}, ${criterion.id})"
                                         style="width: 14px; height: 14px;">
                                        ${criterion.completed ? '<i class="fas fa-check" style="color: white; font-size: 0.6rem;"></i>' : ''}
                                    </div>
                                    <span style="${criterion.completed ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${criterion.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function renderNotes() {
            const notesContainer = document.getElementById('notesContainer');
            if (!notesContainer) return;
            
            if (notes.length === 0) {
                notesContainer.innerHTML = `
                    <div style="text-align:center;opacity:0.5;padding:3rem;">
                        No notes yet. Add your first note!
                    </div>
                `;
                return;
            }
            
            notesContainer.innerHTML = notes.map(note => `
                <div class="note-card" onclick="openNoteModal(${note.id})">
                    <div class="note-title">${note.title}</div>
                    <div class="note-content">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</div>
                </div>
            `).join('');
        }
        
        function renderDashboard() {
            updateQuickStats();
            updateRecentActivity();
        }
        
        // View Management
        function switchView(view) {
            if (currentView === view) return;
            
            currentView = view;
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.view-btn').forEach(el => el.classList.remove('active'));
            
            const navItem = document.querySelector(`[data-view="${view}"]`);
            if (navItem) navItem.classList.add('active');
            
            const viewBtn = document.querySelector(`.view-btn[data-view="${view}"]`);
            if (viewBtn) viewBtn.classList.add('active');
            
            // Show/hide views
            document.querySelectorAll('.view-content').forEach(el => el.style.display = 'none');
            
            const currentViewEl = document.getElementById(`${view}View`);
            if (currentViewEl) {
                currentViewEl.style.display = 'block';
            }
            
            // Update header
            const titles = {
                dashboard: 'Dashboard',
                tasks: 'My Tasks',
                goals: 'Goals',
                kanban: 'Kanban Board',
                analytics: 'Analytics',
                habits: 'Habits',
                notes: 'Notes',
                calendar: 'Calendar'
            };
            
            const subtitles = {
                dashboard: 'Your productivity command center',
                tasks: 'Manage your daily tasks and priorities',
                goals: 'Track your long-term objectives',
                kanban: 'Visual workflow management',
                analytics: 'Insights into your productivity',
                habits: 'Build consistent daily routines',
                notes: 'Capture your thoughts and ideas',
                calendar: 'Schedule and timeline view'
            };
            
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) pageTitle.textContent = titles[view] || view;
            
            const pageSubtitle = document.getElementById('pageSubtitle');
            if (pageSubtitle) pageSubtitle.textContent = subtitles[view] || '';
            
            // Trigger specific view updates
            if (view === 'analytics') {
                updateAnalytics();
            } else if (view === 'dashboard') {
                renderDashboard();
            }
        }
        
        function setFilter(filter) {
            currentFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('[data-filter]').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-filter="${filter}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            renderTasks();
        }
        
        // Analytics and Statistics
        function updateAnalytics() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(t => {
                if (!t.dueDate) return false;
                return new Date(t.dueDate).toDateString() === today;
            });
            const todayCompleted = todayTasks.filter(t => t.completed).length;
            
            const overdue = tasks.filter(t => {
                if (!t.dueDate || t.completed) return false;
                return new Date(t.dueDate) < new Date();
            }).length;
            
            const activeGoalsCount = goals.filter(g => !g.completedAt).length;
            
            // Update dashboard stats
            const todayTasksCount = document.getElementById('todayTasksCount');
            if (todayTasksCount) todayTasksCount.textContent = todayTasks.length;
            
            const completionRateEl = document.getElementById('completionRate');
            if (completionRateEl) completionRateEl.textContent = completionRate + '%';
            
            const completionProgress = document.getElementById('completionProgress');
            if (completionProgress) completionProgress.style.width = completionRate + '%';
            
            const activeGoals = document.getElementById('activeGoals');
            if (activeGoals) activeGoals.textContent = activeGoalsCount;
            
            // Update analytics view
            const totalTasks = document.getElementById('totalTasks');
            if (totalTasks) totalTasks.textContent = total;
            
            const completedTasks = document.getElementById('completedTasks');
            if (completedTasks) completedTasks.textContent = completed;
            
            const analyticsProgress = document.getElementById('analyticsProgress');
            if (analyticsProgress) analyticsProgress.style.width = completionRate + '%';
            
            // Calculate productivity score
            const productivityScore = calculateProductivityScore();
            const productivityScoreEl = document.getElementById('productivityScore');
            if (productivityScoreEl) productivityScoreEl.textContent = productivityScore;
            
            // Update streak
            const streak = calculateStreak();
            const streakDays = document.getElementById('streakDays');
            if (streakDays) streakDays.textContent = streak;
        }
        
        function calculateProductivityScore() {
            const recentTasks = tasks.filter(t => {
                const taskDate = new Date(t.createdAt);
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                return taskDate > weekAgo;
            });
            
            if (recentTasks.length === 0) return 85;
            
            const recentCompleted = recentTasks.filter(t => t.completed).length;
            const baseScore = Math.round((recentCompleted / recentTasks.length) * 100);
            
            // Bonus points for consistency, high priority tasks, etc.
            const streak = calculateStreak();
            const streakBonus = Math.min(streak * 2, 15);
            
            const highPriorityCompleted = recentTasks.filter(t => t.completed && t.priority === 'high').length;
            const priorityBonus = highPriorityCompleted * 3;
            
            return Math.min(baseScore + streakBonus + priorityBonus, 100);
        }
        
        function calculateStreak() {
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() - i);
                
                const hasCompletedTask = tasks.some(task => {
                    if (!task.completedAt) return false;
                    const completedDate = new Date(task.completedAt);
                    return completedDate.toDateString() === checkDate.toDateString();
                });
                
                if (hasCompletedTask || i === 0) { // Include today even if no tasks completed yet
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            
            return Math.max(streak - 1, 0); // Don't count today if no tasks completed
        }
        
        // Modal Management
        function openTaskModal() {
            const taskModal = document.getElementById('taskModal');
            if (taskModal) taskModal.classList.add('active');
            
            const taskTitle = document.getElementById('taskTitle');
            if (taskTitle) taskTitle.focus();
        }
        
        function closeTaskModal() {
            const taskModal = document.getElementById('taskModal');
            if (taskModal) taskModal.classList.remove('active');
            
            const taskForm = document.getElementById('taskForm');
            if (taskForm) {
                taskForm.reset();
                delete taskForm.dataset.editId;
            }
            
            const modalTitle = document.querySelector('#taskModal h2');
            if (modalTitle) modalTitle.textContent = 'Add New Task';
            
            const submitButton = document.querySelector('#taskForm button[type="submit"]');
            if (submitButton) submitButton.textContent = 'Add Task';
        }
        
        function openGoalModal() {
            const goalModal = document.getElementById('goalModal');
            if (goalModal) goalModal.classList.add('active');
            
            const goalTitle = document.getElementById('goalTitle');
            if (goalTitle) goalTitle.focus();
        }
        
        function closeGoalModal() {
            const goalModal = document.getElementById('goalModal');
            if (goalModal) goalModal.classList.remove('active');
            
            const goalForm = document.getElementById('goalForm');
            if (goalForm) {
                goalForm.reset();
                delete goalForm.dataset.editId;
            }
            
            const modalTitle = document.querySelector('#goalModal h2');
            if (modalTitle) modalTitle.textContent = 'Add New Goal';
            
            const submitButton = document.querySelector('#goalForm button[type="submit"]');
            if (submitButton) submitButton.textContent = 'Add Goal';
        }
        
        function openNoteModal(editId = null) {
            document.getElementById('noteModal').classList.add('active');
            document.getElementById('noteModalTitle').textContent = editId ? 'Edit Note' : 'Add Note';
            document.getElementById('noteForm').dataset.editId = editId || '';
            document.getElementById('noteForm').reset();
            if (editId) {
                const note = notes.find(n => n.id == editId);
                if (note) {
                    document.getElementById('noteTitle').value = note.title;
                    document.getElementById('noteContent').value = note.content;
                }
            }
            document.getElementById('noteTitle').focus();
        }
        
        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('active');
            document.getElementById('noteForm').reset();
            document.getElementById('noteForm').dataset.editId = '';
        }
        
        function showFeatureList() {
            const featureModal = document.getElementById('featureModal');
            if (featureModal) featureModal.classList.add('active');
        }
        
        function closeFeatureModal() {
            const featureModal = document.getElementById('featureModal');
            if (featureModal) featureModal.classList.remove('active');
        }
        
        function openCareerWizard() {
            document.getElementById('careerModal').classList.add('active');
        }
        
        function closeCareerModal() {
            document.getElementById('careerModal').classList.remove('active');
            document.getElementById('careerReport').style.display = 'none';
        }
        
        function openAITutor() {
            document.getElementById('aiTutorModal').classList.add('active');
        }
        
        function closeDeepFocusModal() {
            document.getElementById('deepFocusModal').classList.remove('active');
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        // Form Handlers
        function handleTaskSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const editId = form.dataset.editId;
            
            const taskData = {
                title: document.getElementById('taskTitle')?.value.trim() || '',
                category: document.getElementById('taskCategory')?.value || 'other',
                description: document.getElementById('taskDescription')?.value.trim() || '',
                priority: document.getElementById('taskPriority')?.value || 'medium',
                status: document.getElementById('taskStatus')?.value || 'todo',
                dueDate: document.getElementById('taskDueDate')?.value || null,
                estimatedTime: parseFloat(document.getElementById('taskEstimatedTime')?.value) || null,
                tags: document.getElementById('taskTags')?.value.split(',').map(tag => tag.trim()).filter(tag => tag) || [],
                subtasksText: document.getElementById('taskSubtasks')?.value.trim() || ''
            };
            
            if (editId) {
                const task = tasks.find(t => t.id == editId);
                if (task) {
                    Object.assign(task, taskData);
                    
                    // Update subtasks
                    if (taskData.subtasksText) {
                        task.subtasks = taskData.subtasksText.split('\n')
                            .filter(s => s.trim())
                            .map((s, index) => ({
                                id: task.subtasks[index]?.id || Date.now() + Math.random(),
                                text: s.trim(),
                                completed: task.subtasks[index]?.completed || false
                            }));
                    } else {
                        task.subtasks = [];
                    }
                    
                    saveAllData();
                    renderAll();
                    showNotification('Task updated successfully!', 'success');
                }
            } else {
                addTask(taskData);
            }
            
            closeTaskModal();
        }
        
        function handleGoalSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const editId = form.dataset.editId;
            
            const goalData = {
                title: document.getElementById('goalTitle')?.value.trim() || '',
                description: document.getElementById('goalDescription')?.value.trim() || '',
                category: document.getElementById('goalCategory')?.value || 'personal',
                targetDate: document.getElementById('goalTargetDate')?.value || null,
                criteriaText: document.getElementById('goalCriteria')?.value.trim() || ''
            };
            
            if (editId) {
                const goal = goals.find(g => g.id == editId);
                if (goal) {
                    Object.assign(goal, goalData);
                    
                    if (goalData.criteriaText) {
                        goal.criteria = goalData.criteriaText.split('\n')
                            .filter(c => c.trim())
                            .map((c, index) => ({
                                id: goal.criteria[index]?.id || Date.now() + Math.random(),
                                text: c.trim(),
                                completed: goal.criteria[index]?.completed || false
                            }));
                    } else {
                        goal.criteria = [];
                    }
                    
                    saveAllData();
                    renderAll();
                    showNotification('Goal updated successfully!', 'success');
                }
            } else {
                addGoal(goalData);
            }
            
            closeGoalModal();
        }
        
        function handleNoteSubmit(event) {
            event.preventDefault();
            
            const form = event.target;
            const editId = form.dataset.editId;
            
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            
            if (editId) {
                const note = notes.find(n => n.id == editId);
                if (note) {
                    note.title = title;
                    note.content = content;
                    showNotification('Note updated!', 'success');
                }
            } else {
                notes.unshift({
                    id: Date.now() + Math.random(),
                    title,
                    content,
                    createdAt: new Date().toISOString()
                });
                showNotification('Note added!', 'success');
            }
            
            saveAllData();
            renderNotes();
            closeNoteModal();
        }
        
        function deleteNote(noteId) {
            if (confirm('Delete this note?')) {
                notes = notes.filter(n => n.id != noteId);
                saveAllData();
                renderNotes();
                showNotification('Note deleted!', 'error');
            }
        }
        
        // Theme Management
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('taskflow-theme', newTheme);
            
            const icon = document.getElementById('themeIcon');
            if (icon) {
                icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
            
            showNotification(`Switched to ${newTheme} theme`, 'info');
        }
        
        // Timer Management
        function startTimer() {
            if (!isTimerRunning) {
                isTimerRunning = true;
                const playIcon = document.getElementById('playIcon');
                if (playIcon) playIcon.className = 'fas fa-pause';
                
                timerInterval = setInterval(() => {
                    if (timerSeconds === 0) {
                        if (timerMinutes === 0) {
                            completeTimerSession();
                            return;
                        }
                        timerMinutes--;
                        timerSeconds = 59;
                    } else {
                        timerSeconds--;
                    }
                    updateTimerDisplay();
                }, 1000);
                
                showNotification('Focus session started! ðŸ…', 'info');
            } else {
                pauseTimer();
            }
        }
        
        function pauseTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            const playIcon = document.getElementById('playIcon');
            if (playIcon) playIcon.className = 'fas fa-play';
            showNotification('Timer paused', 'info');
        }
        
        function resetTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            timerMinutes = 25;
            timerSeconds = 0;
            updateTimerDisplay();
            const playIcon = document.getElementById('playIcon');
            if (playIcon) playIcon.className = 'fas fa-play';
        }
        
        function completeTimerSession() {
            resetTimer();
            sessionCount++;
            
            if (sessionCount > 4) sessionCount = 1;
            const sessionCountEl = document.getElementById('sessionCount');
            if (sessionCountEl) sessionCountEl.textContent = sessionCount;
            
            showNotification('ðŸŽ‰ Pomodoro completed! Time for a break!', 'success');
            triggerCelebration();
            
            // Auto-start break timer (5 or 15 minutes)
            const breakMinutes = sessionCount === 1 ? 15 : 5; // Long break after 4 sessions
            setTimeout(() => {
                if (confirm(`Take a ${breakMinutes}-minute break?`)) {
                    startBreakTimer(breakMinutes);
                }
            }, 1000);
        }
        
        function startBreakTimer(minutes) {
            timerMinutes = minutes;
            timerSeconds = 0;
            updateTimerDisplay();
            showNotification(`${minutes}-minute break started! â˜•`, 'info');
        }
        
        function updateTimerDisplay() {
            const display = `${timerMinutes.toString().padStart(2, '0')}:${timerSeconds.toString().padStart(2, '0')}`;
            const timerDisplay = document.getElementById('timerDisplay');
            if (timerDisplay) timerDisplay.textContent = display;
        }
        
        function startTaskTimer(taskId) {
            const task = tasks.find(t => t.id == taskId);
            if (task) {
                showNotification(`Started timer for: ${task.title}`, 'info');
                // Here you could implement task-specific timing
                startTimer();
            }
        }
        
        // Voice and AI Features
        function startVoiceInput() {
            if ('webkitSpeechRecognition' in window && window.recognition) {
                const quickAddInput = document.getElementById('quickAddInput');
                if (quickAddInput) {
                    quickAddInput.placeholder = 'ðŸŽ¤ Listening...';
                }
                window.recognition.start();
                showNotification('ðŸŽ¤ Listening... Speak your task!', 'info');
                
                setTimeout(() => {
                    if (quickAddInput) {
                        quickAddInput.placeholder = 'ðŸŽ¯ Quick add: \'Finish report tomorrow 3pm\' or \'Exercise daily\'';
                    }
                }, 5000);
            } else {
                showNotification('Voice recognition not supported in this browser', 'error');
            }
        }
        
        function startVoiceCommand() {
            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const command = event.results[0][0].transcript.toLowerCase();
                    executeVoiceCommand(command);
                };
                
                recognition.start();
            }
        }
        
        function executeVoiceCommand(command) {
            if (command.includes('add task')) openTaskModal();
            else if (command.includes('add goal')) openGoalModal();
            else if (command.includes('focus')) toggleDeepFocus();
            else if (command.includes('mentor')) openAITutor();
            else if (command.includes('career')) openCareerWizard();
            else if (command.includes('analytics')) switchView('analytics');
            else if (command.includes('tasks')) switchView('tasks');
            else if (command.includes('goals')) switchView('goals');
            else if (command.includes('notes')) switchView('notes');
            else showNotification('Command not recognized: ' + command, 'info');
        }
        
        function applySuggestion(suggestion) {
            const quickAddInput = document.getElementById('quickAddInput');
            if (quickAddInput) {
                quickAddInput.value = suggestion;
                processQuickAdd();
            }
        }
        
        function updateAISuggestions() {
            const suggestions = generateSmartSuggestions();
            const container = document.getElementById('aiSuggestions');
            if (!container) return;
            
            // Keep the label and update suggestions
            const label = container.querySelector('span');
            container.innerHTML = '';
            if (label) container.appendChild(label);
            
            suggestions.forEach(suggestion => {
                const chip = document.createElement('div');
                chip.className = 'suggestion-chip';
                chip.textContent = suggestion;
                chip.onclick = () => applySuggestion(suggestion);
                container.appendChild(chip);
            });
        }
        
        function generateSmartSuggestions() {
            const suggestions = [];
            const now = new Date();
            const hour = now.getHours();
            
            // Time-based suggestions
            if (hour < 10) {
                suggestions.push('Review today\'s priorities');
                suggestions.push('Morning workout');
            } else if (hour < 14) {
                suggestions.push('Follow up on emails');
                suggestions.push('Take a walk');
            } else if (hour < 18) {
                suggestions.push('Prepare tomorrow\'s tasks');
                suggestions.push('Review progress');
            } else {
                suggestions.push('Plan tomorrow');
                suggestions.push('Reflect on today');
            }
            
            // Pattern-based suggestions from user's history
            const commonTags = getCommonTags();
            if (commonTags.includes('learning')) {
                suggestions.push('Read for 30 minutes');
            }
            if (commonTags.includes('work')) {
                suggestions.push('Check project status');
            }
            
            return suggestions.slice(0, 4); // Limit to 4 suggestions
        }
        
        function getCommonTags() {
            const tagCounts = {};
            tasks.forEach(task => {
                task.tags.forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            });
            
            return Object.entries(tagCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([tag]) => tag);
        }
        
        function showAICoach() {
            const tip = aiTips[Math.floor(Math.random() * aiTips.length)];
            showNotification(`ðŸ’¡ AI Coach: ${tip}`, 'info');
        }
        
        function getNewTip() {
            const tip = aiTips[Math.floor(Math.random() * aiTips.length)];
            const tipElement = document.querySelector('#aiCoachTips p:last-child');
            if (tipElement) tipElement.textContent = tip;
            showNotification('New productivity tip loaded! ðŸ’¡', 'success');
        }
        
        function generateInsights() {
            const insights = [];
            
            const completionRate = tasks.length > 0 ? 
                Math.round((tasks.filter(t => t.completed).length / tasks.length) * 100) : 0;
            
            if (completionRate > 80) {
                insights.push('ðŸŽ‰ Excellent completion rate! You\'re crushing your goals!');
            } else if (completionRate > 60) {
                insights.push('ðŸ‘ Good progress! Consider breaking down larger tasks.');
            } else {
                insights.push('ðŸ’ª Focus on completing smaller tasks first to build momentum.');
            }
            
            const overdueTasks = tasks.filter(t => {
                if (!t.dueDate || t.completed) return false;
                return new Date(t.dueDate) < new Date();
            });
            
            if (overdueTasks.length > 0) {
                insights.push(`âš ï¸ You have ${overdueTasks.length} overdue task(s). Consider rescheduling or breaking them down.`);
            }
            
            const highPriorityPending = tasks.filter(t => t.priority === 'high' && !t.completed).length;
            if (highPriorityPending > 3) {
                insights.push('ðŸ”¥ Many high-priority tasks pending. Focus on the most important ones first.');
            }
            
            showNotification(insights[Math.floor(Math.random() * insights.length)], 'info');
        }
        
        // DeepSeek API Integration
        async function queryDeepSeek(prompt) {
            if (!checkApiKey()) return null;
            
            const now = Date.now();
            if (now - lastAICallTime < AI_COOLDOWN) {
                showNotification('Please wait before making another request', 'warning');
                return null;
            }
            
            lastAICallTime = now;
            
            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${userApiKey}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'TaskFlow Pro'
                    },
                    body: JSON.stringify({
                        model: "deepseek-ai/deepseek-r1",
                        messages: [{ role: "user", content: prompt }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('API Error:', error);
                showNotification(`API Error: ${error.message}`, 'error');
                return null;
            }
        }
        
        async function generateCareerPlan() {
            const career = document.getElementById('careerGoal').value.trim();
            const years = document.getElementById('experienceYears').value;
            
            if (!career) return;
            
            // Show loading
            document.getElementById('careerReport').innerHTML = '<p>Generating career plan...</p>';
            document.getElementById('careerReport').style.display = 'block';
            
            try {
                const prompt = `As a career advisor, create a detailed report for someone wanting to become a ${career} with ${years} years of experience. 
                Include: 
                - Job outlook and market demand
                - Average salary range
                - Required skills and qualifications
                - Recommended learning path
                - Potential career growth opportunities
                - AI confidence score (0-100%) for success based on current trends
                Format with clear headings.`;
                
                const report = await queryDeepSeek(prompt);
                
                if (report) {
                    document.getElementById('careerReport').innerHTML = report;
                } else {
                    document.getElementById('careerReport').innerHTML = '<p>Failed to generate report. Please try again.</p>';
                }
            } catch (error) {
                document.getElementById('careerReport').innerHTML = '<p>Error generating career plan. Please try again later.</p>';
            }
        }
        
        async function askAI() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) return;
            
            // Add user message to chat
            addAIMessage(question, 'user');
            document.getElementById('aiQuestion').value = '';
            
            // Show loading indicator
            const aiChatContainer = document.getElementById('aiChatContainer');
            const loadingMessage = document.createElement('div');
            loadingMessage.textContent = 'Thinking...';
            loadingMessage.style.textAlign = 'center';
            loadingMessage.style.opacity = '0.7';
            aiChatContainer.appendChild(loadingMessage);
            aiChatContainer.scrollTop = aiChatContainer.scrollHeight;
            
            try {
                // Get AI response
                const response = await queryDeepSeek(
                    `As a learning mentor, provide a detailed answer and create a step-by-step learning plan for: "${question}". 
                    Format the learning plan as a numbered list.`
                );
                
                // Remove loading
                aiChatContainer.removeChild(loadingMessage);
                
                if (response) {
                    addAIMessage(response, 'ai');
                    
                    // Extract learning plan
                    const planMatch = response.match(/(\d+\..+?)(?=\d+\.|$)/gs);
                    if (planMatch) {
                        const planHtml = `<ol>${planMatch.map(item => `<li>${item.trim()}</li>`).join('')}</ol>`;
                        document.getElementById('planContent').innerHTML = planHtml;
                        document.getElementById('learningPlanContainer').style.display = 'block';
                    }
                } else {
                    addAIMessage('Sorry, I encountered an error. Please try again later.', 'ai');
                }
            } catch (error) {
                aiChatContainer.removeChild(loadingMessage);
                addAIMessage('Failed to get response. Please check your connection.', 'ai');
            }
        }
        
        function addAIMessage(message, sender) {
            const aiChatContainer = document.getElementById('aiChatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '0.5rem';
            messageDiv.style.padding = '0.5rem';
            messageDiv.style.borderRadius = '0.5rem';
            messageDiv.style.background = sender === 'user' ? 'var(--primary)' : 'var(--surface)';
            messageDiv.style.color = sender === 'user' ? 'white' : 'var(--text)';
            messageDiv.textContent = message;
            aiChatContainer.appendChild(messageDiv);
            aiChatContainer.scrollTop = aiChatContainer.scrollHeight;
        }
        
        function scheduleLearningPlan() {
            showNotification('Learning plan added to your tasks!', 'success');
        }
        
        // Deep Focus Feature
        function toggleDeepFocus() {
            if (deepFocusActive) {
                stopDeepFocus();
            } else {
                openDeepFocusModal();
            }
        }
        
        function startDeepFocus() {
            const duration = document.getElementById('focusDuration').value || 25;
            const volume = document.getElementById('focusVolume').value || 50;
            const sound = document.getElementById('focusSound').value || 'white';
            
            // Implementation details
            showNotification(`Deep focus started for ${duration} minutes`, 'success');
            deepFocusActive = true;
            document.getElementById('deepFocusBtn').innerHTML = '<i class="fas fa-stop"></i> Stop Focus';
            closeDeepFocusModal();
        }
        
        function stopDeepFocus() {
            deepFocusActive = false;
            document.getElementById('deepFocusBtn').innerHTML = '<i class="fas fa-headphones"></i> Deep Focus';
            showNotification('Deep focus stopped', 'info');
        }
        
        // API Key Management
        function checkApiKey() {
            if (!userApiKey) {
                showApiKeyModal();
                return false;
            }
            return true;
        }
        
        function showApiKeyModal() {
            document.getElementById('apiKeyModal').classList.add('active');
            document.getElementById('apiKeyInput').focus();
        }
        
        function closeApiKeyModal() {
            document.getElementById('apiKeyModal').classList.remove('active');
        }
        
        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                userApiKey = key;
                localStorage.setItem('userApiKey', key);
                closeApiKeyModal();
                showNotification('API key saved successfully!', 'success');
                updateApiKeyStatus();
            } else {
                showNotification('Please enter a valid API key', 'error');
            }
        }
        
        function clearApiKey() {
            if (confirm('Are you sure you want to remove your API key? AI features will stop working.')) {
                userApiKey = '';
                localStorage.removeItem('userApiKey');
                showNotification('API key removed', 'info');
                updateApiKeyStatus();
            }
        }
        
        // Secure key masking for display
        function getMaskedKey() {
            if (!userApiKey) return 'Not set';
            return userApiKey.substring(0, 8) + '...' + userApiKey.substring(userApiKey.length - 4);
        }
        
        function updateApiKeyStatus() {
            document.querySelectorAll('[data-requires-api]').forEach(el => {
                if (userApiKey) {
                    el.style.opacity = '1';
                    el.style.pointerEvents = 'auto';
                } else {
                    el.style.opacity = '0.5';
                    el.style.pointerEvents = 'none';
                }
            });
        }
        
        // Offline Mode
        function checkOnlineStatus() {
            const isOnline = navigator.onLine;
            document.getElementById('offlineStatus').style.display = isOnline ? 'none' : 'block';
        }
        
        function processAIQueue() {
            if (aiRequestQueue.length > 0 && navigator.onLine) {
                showNotification('Processing queued AI requests...', 'info');
                aiRequestQueue.forEach(request => {
                    if (request.type === 'tutor') {
                        askAI(request.data);
                    }
                });
                aiRequestQueue.length = 0; // Clear queue
            }
        }
        
        // Motivation Bar
        function showMotivationMessage(message) {
            document.getElementById('motivationText').textContent = message;
            document.getElementById('motivationBar').style.display = 'block';
        }
        
        function closeMotivationBar() {
            document.getElementById('motivationBar').style.display = 'none';
        }
        
        function checkForNotifications() {
            // Check every 30 minutes
            setInterval(() => {
                // Check for missed tasks
                const missedTasks = tasks.filter(t => !t.completed && t.dueDate && new Date(t.dueDate) < new Date());
                
                if (missedTasks.length > 0) {
                    showMotivationMessage(`âš ï¸ You have ${missedTasks.length} overdue tasks!`);
                }
                else if (tasks.some(t => !t.completed)) {
                    showMotivationMessage("ðŸ’ª You're doing great! Keep going!");
                }
            }, 30 * 60 * 1000);
        }
        
        // Utility Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = date.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Tomorrow';
            if (diffDays === -1) return 'Yesterday';
            if (diffDays > 0 && diffDays < 7) return `${diffDays} days`;
            if (diffDays < 0 && diffDays > -7) return `${Math.abs(diffDays)} days ago`;
            
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                hour: date.getHours() !== 0 ? 'numeric' : undefined,
                minute: date.getMinutes() !== 0 ? '2-digit' : undefined
            });
        }
        
        function updateCounts() {
            const todayTasks = tasks.filter(t => {
                if (!t.dueDate) return false;
                return new Date(t.dueDate).toDateString() === new Date().toDateString();
            });
            
            const overdueTasks = tasks.filter(t => {
                if (!t.dueDate || t.completed) return false;
                return new Date(t.dueDate) < new Date();
            }).length;
            
            const taskCount = document.getElementById('taskCount');
            if (taskCount) taskCount.textContent = tasks.filter(t => !t.completed).length;
            
            const goalCount = document.getElementById('goalCount');
            if (goalCount) goalCount.textContent = goals.filter(g => !g.completedAt).length;
            
            const todayCount = document.getElementById('todayCount');
            if (todayCount) todayCount.textContent = todayTasks.length;
            
            const overdueCount = document.getElementById('overdueCount');
            if (overdueCount) overdueCount.textContent = overdueTasks;
        }
        
        function updateKanbanCounts() {
            const counts = {
                todo: tasks.filter(t => t.status === 'todo').length,
                progress: tasks.filter(t => t.status === 'progress').length,
                review: tasks.filter(t => t.status === 'review').length,
                completed: tasks.filter(t => t.status === 'completed').length
            };
            
            Object.entries(counts).forEach(([status, count]) => {
                const element = document.getElementById(`${status}Count`);
                if (element) element.textContent = count;
            });
        }
        
        function updateQuickStats() {
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(t => t.dueDate && new Date(t.dueDate).toDateString() === today);
            const todayCompleted = todayTasks.filter(t => t.completed).length;
            
            const thisWeekStart = new Date();
            thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
            const weekTasks = tasks.filter(t => new Date(t.createdAt) >= thisWeekStart);
            const weekCompleted = weekTasks.filter(t => t.completed).length;
            
            const goalProgressAvg = goals.length > 0 ? 
                Math.round(goals.reduce((sum, goal) => sum + goal.progress, 0) / goals.length) : 0;
            
            const todayStats = document.getElementById('todayStats');
            if (todayStats) todayStats.textContent = `${todayCompleted}/${todayTasks.length}`;
            
            const weekStats = document.getElementById('weekStats');
            if (weekStats) weekStats.textContent = `${weekCompleted}/${weekTasks.length}`;
            
            const goalProgress = document.getElementById('goalProgress');
            if (goalProgress) goalProgress.textContent = `${goalProgressAvg}%`;
            
            const focusTimeToday = document.getElementById('focusTimeToday');
            if (focusTimeToday) focusTimeToday.textContent = '2.5h'; // This would be calculated from timer sessions
        }
        
                // ... (your existing code ended at the updateRecentActivity function) ...

        function updateRecentActivity() {
            const recentActivities = [
                ...tasks.slice(0, 3).map(t => ({
                    type: 'task',
                    action: t.completed ? 'completed' : 'created',
                    title: t.title,
                    time: t.completed ? t.completedAt : t.createdAt
                })),
                ...goals.slice(0, 2).map(g => ({
                    type: 'goal',
                    action: 'created',
                    title: g.title,
                    time: g.createdAt
                })),
                ...notes.slice(0, 2).map(n => ({
                    type: 'note',
                    action: 'created',
                    title: n.title,
                    time: n.createdAt
                }))
            ].sort((a, b) => new Date(b.time) - new Date(a.time)).slice(0, 5);
            
            const html = recentActivities.map(activity => `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-size: 0.85rem;">
                    <i class="fas fa-${activity.type === 'task' ? 'check-circle' : activity.type === 'goal' ? 'bullseye' : 'sticky-note'}" style="color: var(--${activity.action === 'completed' ? 'success' : 'primary'}); width: 12px;"></i>
                    <span style="flex: 1; opacity: 0.8;">${activity.action} "${activity.title.substring(0, 20)}${activity.title.length > 20 ? '...' : ''}"</span>
                    <span style="font-size: 0.7rem; opacity: 0.6;">${formatTimeAgo(activity.time)}</span>
                </div>
            `).join('');
            
            const recentActivity = document.getElementById('recentActivity');
            if (recentActivity) recentActivity.innerHTML = html;
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            
            return Math.floor(seconds) + " seconds ago";
        }

        function generateMiniCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let calendarHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600;">
                    <span>${now.toLocaleString('default', { month: 'short' })} ${year}</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.1rem; text-align: center;">
                    <div style="font-size:0.7rem;opacity:0.5;">S</div>
                    <div style="font-size:0.7rem;opacity:0.5;">M</div>
                    <div style="font-size:0.7rem;opacity:0.5;">T</div>
                    <div style="font-size:0.7rem;opacity:0.5;">W</div>
                    <div style="font-size:0.7rem;opacity:0.5;">T</div>
                    <div style="font-size:0.7rem;opacity:0.5;">F</div>
                    <div style="font-size:0.7rem;opacity:0.5;">S</div>
            `;
            
            // Empty days for the first week
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div></div>';
            }
            
            // Days of the month
            const today = now.getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const hasTask = tasks.some(task => {
                    if (!task.dueDate) return false;
                    const dueDate = new Date(task.dueDate);
                    return dueDate.getDate() === day && 
                           dueDate.getMonth() === month && 
                           dueDate.getFullYear() === year;
                });
                
                const isToday = day === today;
                
                calendarHTML += `
                    <div style="font-size:0.8rem; padding:0.2rem; border-radius:0.3rem; 
                        ${isToday ? 'background: var(--primary); color:white;' : ''}
                        ${hasTask ? 'border: 1px solid var(--primary);' : ''}">
                        ${day}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            
            const miniCalendar = document.getElementById('miniCalendar');
            if (miniCalendar) miniCalendar.innerHTML = calendarHTML;
        }

        function updateStreakTracker() {
            const streak = calculateStreak();
            const currentStreak = document.getElementById('currentStreak');
            if (currentStreak) currentStreak.textContent = `${streak} Days`;
            
            const habitTracker = document.getElementById('streakTracker');
            if (!habitTracker) return;
            
            habitTracker.innerHTML = '';
            
            // Create 7 days (for this week)
            const today = new Date();
            const dayOfWeek = today.getDay(); // Sunday = 0, Monday = 1, etc.
            
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(today);
                dayDate.setDate(today.getDate() - (dayOfWeek - i));
                
                const hasCompletedTask = tasks.some(task => {
                    if (!task.completedAt) return false;
                    const completedDate = new Date(task.completedAt);
                    return completedDate.toDateString() === dayDate.toDateString();
                });
                
                const dayEl = document.createElement('div');
                dayEl.className = `habit-day ${hasCompletedTask ? 'completed' : ''}`;
                dayEl.textContent = dayDate.toLocaleString('default', { weekday: 'narrow' });
                habitTracker.appendChild(dayEl);
            }
        }

        function saveAllData() {
            try {
                localStorage.setItem('taskflow-tasks', JSON.stringify(tasks));
                localStorage.setItem('taskflow-goals', JSON.stringify(goals));
                localStorage.setItem('taskflow-habits', JSON.stringify(habits));
                localStorage.setItem('taskflow-notes', JSON.stringify(notes));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function loadSampleData() {
            if (tasks.length === 0 && goals.length === 0 && notes.length === 0) {
                // Add sample tasks
                tasks = [
                    {
                        id: 1,
                        title: 'Complete project proposal',
                        category: 'work',
                        description: 'Finish the proposal document for client review',
                        priority: 'high',
                        status: 'progress',
                        completed: false,
                        dueDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                        tags: ['work', 'urgent'],
                        subtasks: [
                            { id: 1, text: 'Research requirements', completed: true },
                            { id: 2, text: 'Create outline', completed: true },
                            { id: 3, text: 'Write first draft', completed: false }
                        ],
                        createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                        estimatedTime: 3
                    },
                    {
                        id: 2,
                        title: 'Morning workout',
                        category: 'health',
                        description: '30-minute cardio session',
                        priority: 'medium',
                        status: 'todo',
                        completed: false,
                        dueDate: new Date().toISOString(),
                        tags: ['health', 'routine'],
                        subtasks: [],
                        createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                        estimatedTime: 0.5
                    },
                    {
                        id: 3,
                        title: 'Read Chapter 5',
                        category: 'learning',
                        description: 'Complete chapter on JavaScript design patterns',
                        priority: 'medium',
                        status: 'todo',
                        completed: false,
                        dueDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString(),
                        tags: ['study'],
                        subtasks: [],
                        createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        estimatedTime: 1
                    }
                ];
                
                // Add sample goals
                goals = [
                    {
                        id: 1,
                        title: 'Learn React',
                        description: 'Master React framework and ecosystem',
                        category: 'learning',
                        targetDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        criteria: [
                            { id: 1, text: 'Complete online course', completed: true },
                            { id: 2, text: 'Build portfolio project', completed: false },
                            { id: 3, text: 'Contribute to open source', completed: false }
                        ],
                        progress: 33,
                        createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 2,
                        title: 'Run 5K',
                        description: 'Prepare for and complete a 5K run',
                        category: 'health',
                        targetDate: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
                        criteria: [
                            { id: 1, text: 'Follow training plan', completed: false },
                            { id: 2, text: 'Run 3 times per week', completed: true },
                            { id: 3, text: 'Complete practice run', completed: false }
                        ],
                        progress: 33,
                        createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                
                // Add sample notes
                notes = [
                    {
                        id: 1,
                        title: 'Meeting Notes',
                        content: 'Discussed project timelines and deliverables. Need to follow up with design team.',
                        createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 2,
                        title: 'Book Ideas',
                        content: 'Potential book topics:\n- Productivity systems\n- Modern JavaScript patterns\n- AI applications',
                        createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                
                saveAllData();
            }
        }

        function triggerCelebration() {
            // Create celebration elements
            const celebration = document.createElement('div');
            celebration.style.position = 'fixed';
            celebration.style.top = '0';
            celebration.style.left = '0';
            celebration.style.width = '100%';
            celebration.style.height = '100%';
            celebration.style.pointerEvents = 'none';
            celebration.style.zIndex = '9999';
            document.body.appendChild(celebration);
            
            // Add confetti
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.borderRadius = '50%';
                confetti.style.top = '50%';
                confetti.style.left = '50%';
                confetti.style.transform = 'translate(-50%, -50%)';
                confetti.style.opacity = '0';
                celebration.appendChild(confetti);
                
                // Animate confetti
                const angle = Math.random() * Math.PI * 2;
                const distance = 100 + Math.random() * 200;
                const targetX = Math.cos(angle) * distance;
                const targetY = Math.sin(angle) * distance;
                
                confetti.animate([
                    { transform: 'translate(-50%, -50%)', opacity: 0 },
                    { transform: `translate(${targetX}%, ${targetY}%)`, opacity: 1 },
                    { transform: `translate(${targetX * 1.2}%, ${targetY * 1.2}%)`, opacity: 0 }
                ], {
                    duration: 2000,
                    easing: 'ease-out'
                });
            }
            
            // Remove celebration element after animation
            setTimeout(() => {
                celebration.remove();
            }, 2000);
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.className = `notification ${type} show`;
            document.getElementById('notificationText').textContent = message;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function exportData() {
            const data = {
                tasks,
                goals,
                habits,
                notes,
                version: '1.0',
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `taskflow-backup-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.tasks) tasks = data.tasks;
                        if (data.goals) goals = data.goals;
                        if (data.habits) habits = data.habits;
                        if (data.notes) notes = data.notes;
                        
                        saveAllData();
                        renderAll();
                        updateAnalytics();
                        
                        showNotification('Data imported successfully!', 'success');
                    } catch (error) {
                        showNotification('Invalid data format', 'error');
                        console.error('Import error:', error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function quickActions() {
            const actions = [
                { icon: 'fa-plus', text: 'Add Task', action: openTaskModal },
                { icon: 'fa-bullseye', text: 'Add Goal', action: openGoalModal },
                { icon: 'fa-sticky-note', text: 'Add Note', action: openNoteModal },
                { icon: 'fa-headphones', text: 'Deep Focus', action: toggleDeepFocus }
            ];
            
            // Create floating menu
            const menu = document.createElement('div');
            menu.style.position = 'fixed';
            menu.style.bottom = '90px';
            menu.style.left = '30px';
            menu.style.backgroundColor = 'var(--surface)';
            menu.style.borderRadius = '0.75rem';
            menu.style.boxShadow = 'var(--shadow)';
            menu.style.zIndex = '200';
            menu.style.overflow = 'hidden';
            menu.style.transformOrigin = 'bottom left';
            menu.style.transform = 'scale(0)';
            menu.style.transition = 'transform 0.2s ease';
            menu.id = 'quickActionsMenu';
            
            actions.forEach((action, index) => {
                const button = document.createElement('button');
                button.style.display = 'flex';
                button.style.alignItems = 'center';
                button.style.gap = '0.5rem';
                button.style.padding = '0.8rem 1rem';
                button.style.width = '100%';
                button.style.border = 'none';
                button.style.background = 'none';
                button.style.textAlign = 'left';
                button.style.cursor = 'pointer';
                button.style.transition = 'background 0.2s';
                
                button.innerHTML = `
                    <i class="fas ${action.icon}" style="width:20px;"></i>
                    <span>${action.text}</span>
                `;
                
                button.onclick = () => {
                    action.action();
                    menu.remove();
                };
                
                button.onmouseenter = () => {
                    button.style.background = 'var(--bg)';
                };
                
                button.onmouseleave = () => {
                    button.style.background = 'none';
                };
                
                menu.appendChild(button);
                
                if (index < actions.length - 1) {
                    const divider = document.createElement('div');
                    divider.style.height = '1px';
                    divider.style.background = 'var(--border)';
                    menu.appendChild(divider);
                }
            });
            
            document.body.appendChild(menu);
            
            // Animate menu
            setTimeout(() => {
                menu.style.transform = 'scale(1)';
            }, 10);
            
            // Close menu when clicking outside
            const closeMenu = (e) => {
                if (!menu.contains(e.target)) {
                    menu.style.transform = 'scale(0)';
                    setTimeout(() => {
                        menu.remove();
                    }, 200);
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 100);
        }

        // Drag and drop for Kanban board
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.taskId);
            e.target.style.opacity = '0.4';
            
            // Add dropzone highlighting
            document.querySelectorAll('.kanban-column').forEach(column => {
                column.style.boxShadow = '0 0 0 2px var(--primary)';
            });
        }
        
        function setupDragAndDrop() {
            const kanbanTasks = document.querySelectorAll('.kanban-task');
            const kanbanColumns = document.querySelectorAll('.kanban-column');
            
            kanbanTasks.forEach(task => {
                task.addEventListener('dragstart', handleDragStart);
                task.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '1';
                    
                    // Remove dropzone highlighting
                    document.querySelectorAll('.kanban-column').forEach(column => {
                        column.style.boxShadow = 'none';
                    });
                });
            });
            
            kanbanColumns.forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    column.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
                });
                
                column.addEventListener('dragleave', () => {
                    column.style.backgroundColor = '';
                });
                
                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.style.backgroundColor = '';
                    
                    const taskId = e.dataTransfer.getData('text/plain');
                    const taskElement = document.querySelector(`.kanban-task[data-task-id="${taskId}"]`);
                    const newStatus = column.querySelector('.kanban-tasks').dataset.status;
                    
                    if (taskElement) {
                        const task = tasks.find(t => t.id == taskId);
                        if (task) {
                            task.status = newStatus;
                            saveAllData();
                            renderTasks();
                        }
                    }
                });
            });
        }

        // Goal Management
        function editGoal(goalId) {
            const goal = goals.find(g => g.id == goalId);
            if (goal) {
                const goalTitle = document.getElementById('goalTitle');
                const goalDescription = document.getElementById('goalDescription');
                const goalCategory = document.getElementById('goalCategory');
                const goalTargetDate = document.getElementById('goalTargetDate');
                const goalCriteria = document.getElementById('goalCriteria');
                
                if (goalTitle) goalTitle.value = goal.title;
                if (goalDescription) goalDescription.value = goal.description || '';
                if (goalCategory) goalCategory.value = goal.category || 'personal';
                if (goalTargetDate) goalTargetDate.value = goal.targetDate ? 
                    goal.targetDate.split('T')[0] : '';
                if (goalCriteria) goalCriteria.value = goal.criteria.map(c => c.text).join('\n');
                
                const goalForm = document.getElementById('goalForm');
                if (goalForm) {
                    goalForm.dataset.editId = goalId;
                }
                
                const modalTitle = document.querySelector('#goalModal h2');
                if (modalTitle) modalTitle.textContent = 'Edit Goal';
                
                const submitButton = document.querySelector('#goalForm button[type="submit"]');
                if (submitButton) submitButton.textContent = 'Update Goal';
                
                openGoalModal();
            }
        }

        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                goals = goals.filter(g => g.id != goalId);
                
                // Remove related tasks
                tasks = tasks.filter(t => t.goalId != goalId);
                
                saveAllData();
                renderAll();
                updateAnalytics();
                showNotification('Goal deleted', 'error');
            }
        }

        function toggleGoalCriterion(goalId, criterionId) {
            const goal = goals.find(g => g.id == goalId);
            if (goal) {
                const criterion = goal.criteria.find(c => c.id == criterionId);
                if (criterion) {
                    criterion.completed = !criterion.completed;
                    
                    // Update goal progress
                    const completed = goal.criteria.filter(c => c.completed).length;
                    goal.progress = Math.round((completed / goal.criteria.length) * 100);
                    
                    saveAllData();
                    renderAll();
                }
            }
        }

        function openDeepFocusModal() {
            document.getElementById('deepFocusModal').classList.add('active');
        }

        function startDeepFocus() {
            const duration = document.getElementById('focusDuration').value || 25;
            const volume = document.getElementById('focusVolume').value || 50;
            const sound = document.getElementById('focusSound').value || 'white';
            
            // Start Pomodoro timer with specified duration
            timerMinutes = parseInt(duration);
            timerSeconds = 0;
            startTimer();
            
            // Show notification
            showNotification(`Deep focus started for ${duration} minutes`, 'success');
            deepFocusActive = true;
            document.getElementById('deepFocusBtn').innerHTML = '<i class="fas fa-stop"></i> Stop Focus';
            closeDeepFocusModal();
            
            // Play sound
            playTimerSound('start');
        }

        function stopDeepFocus() {
            deepFocusActive = false;
            pauseTimer();
            document.getElementById('deepFocusBtn').innerHTML = '<i class="fas fa-headphones"></i> Deep Focus';
            showNotification('Deep focus stopped', 'info');
            
            // Play sound
            playTimerSound('end');
        }

        function playTimerSound(type) {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                
                oscillator.type = 'sine';
                
                if (type === 'start') {
                    oscillator.frequency.setValueAtTime(880, context.currentTime);
                    gainNode.gain.setValueAtTime(0.3, context.currentTime);
                } else if (type === 'end') {
                    oscillator.frequency.setValueAtTime(440, context.currentTime);
                    oscillator.frequency.setValueAtTime(660, context.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(880, context.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.5, context.currentTime);
                }
                
                oscillator.start();
                
                // Fade out
                gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.5);
                oscillator.stop(context.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported', e);
            }
        }

        // Initialize drag and drop after DOM is loaded
        setTimeout(() => {
            setupDragAndDrop();
        }, 500);
    </script>
</body>
</html>